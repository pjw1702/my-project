### **로봇 제어 프로토콜 (RCP) 규격서**

---

## **1. 프로토콜 개요**
**로봇 제어 프로토콜(RCP)**은 스마트 팩토리 환경에서 로봇을 효율적으로 제어하고, 명령어와 상태 정보를 송수신하기 위해 설계되었습니다. 이 프로토콜은 네트워크 상에서 데이터를 직렬화하여 전송하며, 메시지의 신뢰성과 무결성을 보장하기 위해 **HMAC** 및 **체크섬**과 같은 보안 기능을 제공합니다.

---

## **2. 메시지 구조**

### **2.1 PDU (Protocol Data Unit)**
RCP의 PDU는 **헤더**와 **데이터(payload)**로 구성됩니다.

#### **PDU 구조**
| **구성 요소**      | **설명**                                                                 |
|-------------------|---------------------------------------------------------------------|
| `Rcphdr` (헤더)    | 메시지의 메타데이터를 포함하며, 메시지의 무결성과 유효성을 보장함.                     |
| `Rcdata` (데이터)  | 로봇의 제어 명령 또는 상태 정보를 담은 데이터.                                           |

---

### **2.2 헤더 (Rcphdr)**

#### **헤더 구조**
| **필드 이름**       | **타입**         | **크기**  | **설명**                                                                                          |
|-------------------|----------------|---------|----------------------------------------------------------------------------------------------|
| `proto_ver`       | `char[8]`      | 8 bytes | 프로토콜 버전 (예: "1.0").                                                                        |
| `msg_type`        | `char[16]`     | 16 bytes| 메시지 유형 (READY, COMMAND, DONE 등).                                                             |
| `res`             | `uint8_t`      | 1 byte  | 예약 필드. (현재 사용하지 않음, 0으로 설정)                                                           |
| `p_size`          | `uint16_t`     | 2 bytes | PDU 전체 크기 (헤더 + 데이터).                                                                      |
| `check`           | `uint16_t`     | 2 bytes | 체크섬 값 (헤더와 데이터를 포함한 무결성 검증).                                                        |
| `secret_key`      | `uint16_t`     | 2 bytes | 보안 키.                                                                                         |
| `timestamp`       | `uint64_t`     | 8 bytes | 메시지 생성 시간 (UNIX 타임스탬프).                                                                   |
| `hash_value`      | `uint32_t`     | 4 bytes | 메시지 데이터의 해시 값.                                                                             |
| `d_len`           | `uint32_t`     | 4 bytes | 데이터 필드(`Rcdata`)의 크기.                                                                         |
| `hmac`            | `uint8_t[32]`  | 32 bytes| HMAC (메시지 인증 코드, 무결성 및 인증 보장).                                                          |

---

### **2.3 데이터 (Rcdata)**

#### **데이터 구조**
| **필드 이름**       | **타입**          | **크기**  | **설명**                                      |
|-------------------|-----------------|---------|------------------------------------------|
| `yaw`            | `long double`   | 8 bytes | Z축 회전 값 (yaw).                           |
| `pitch`          | `long double`   | 8 bytes | Y축 회전 값 (pitch).                         |
| `roll`           | `long double`   | 8 bytes | X축 회전 값 (roll).                          |
| `x_pos`          | `long double`   | 8 bytes | X축 좌표.                                    |
| `y_pos`          | `long double`   | 8 bytes | Y축 좌표.                                    |
| `z_pos`          | `long double`   | 8 bytes | Z축 좌표.                                    |
| `data`           | `char[20]`      | 20 bytes| 기타 명령어나 부가 정보를 포함.                        |

---

## **3. 메시지 유형**

#### **메시지 유형 정의**
| **메시지 유형**     | **설명**                                         |
|-------------------|---------------------------------------------|
| `READY`          | 준비 상태를 알리는 메시지.                             |
| `COMMAND`        | 로봇에게 명령을 전달하는 메시지.                        |
| `DONE`           | 명령이 완료되었음을 알리는 메시지.                      |
| `CONFIRM`        | 명령 확인 요청 메시지.                                |
| `REQUEST`        | 요청 메시지.                                      |
| `ACK`            | 요청이나 명령에 대한 확인 메시지 (Acknowledgement).      |

---

## **4. 응답 코드**

### **4.1 성공 코드 (2xx)**
| **코드** | **설명**                          |
|---------|----------------------------------|
| `200`   | READY 상태 (준비 완료).             |
| `201`   | 명령 실행 완료.                      |
| `240`   | 명령 처리 완료.                      |
| `262`   | 데이터 전송 성공.                    |

### **4.2 클라이언트 오류 코드 (4xx)**
| **코드** | **설명**                          |
|---------|----------------------------------|
| `410`   | READY 상태가 아님.                 |
| `411`   | 매니저 연결 끊김.                   |
| `412`   | 워커 연결 끊김.                     |
| `413`   | 명령이 일시 중단됨.                  |
| `414`   | 명령이 실행되지 않음.                |

### **4.3 서버 오류 코드 (5xx)**
| **코드** | **설명**                          |
|---------|----------------------------------|
| `500`   | 잘못된 명령.                       |
| `501`   | 명령이 없음.                       |

---

## **5. 상수 및 제약 조건**

| **항목**                | **값**                           |
|-----------------------|---------------------------------|
| 최대 메시지 크기          | `1024 bytes`                   |
| 최대 메시지 ID 크기       | `4294967295` (32-bit 정수)      |
| HMAC 크기               | `32 bytes`                     |
| 데이터 필드 최대 크기      | `1024 bytes`                   |

---

## **6. 상태 코드**

| **상태**                 | **값** | **설명**                                 |
|------------------------|-------|-------------------------------------|
| `READY`               | `1`   | 준비 상태.                             |
| `RECEIVE`             | `2`   | 데이터 수신 중.                          |
| `TRANSMIT`            | `3`   | 데이터 전송 중.                          |
| `IDLE`                | `4`   | 대기 상태.                              |
| `PROCESSING`          | `5`   | 명령 처리 중.                           |
| `WAITING_FOR_RESPONSE`| `6`   | 응답 대기 중.                           |
| `ERROR_STATE`         | `7`   | 오류 상태.                              |

---

## **7. 전송 프로세스**

1. **헤더 생성**: `proto_ver`, `msg_type`, `timestamp` 등을 설정.
2. **데이터 직렬화**: 헤더 및 데이터를 직렬화하여 네트워크 전송.
3. **전송 및 응답 처리**: 송신 후 응답 코드 확인 (성공/실패 여부).
4. **역직렬화**: 수신된 데이터를 역직렬화하여 처리.
